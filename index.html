<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>访客记录分页显示</title>
    <style>
        table { border-collapse: collapse; width: 100%; margin-top: 10px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
        th { background: #f4f4f4; }
        button { margin: 5px; padding: 5px 10px; }
    </style>
</head>
<body>

<h2>访客记录</h2>
<div>
    <button id="prevBtn">上一页</button>
    <span id="pageInfo"></span>
    <button id="nextBtn">下一页</button>
</div>

<table>
    <thead>
    <tr>
        <th>ID</th>
        <th>头像</th>
        <th>昵称</th>
        <th>卡片ID</th>
        <th>浏览次数</th>
        <th>更新时间</th>
        <th>是否隐藏</th>
    </tr>
    </thead>
    <tbody id="visitorTableBody"></tbody>
</table>

<script>
    const apiUrl = 'https://api.hunliji.com/hms/eInvitation/appApi/visitors/cardRecord';
    const headers = {
        'token': '952df705ec0d3741e3eea6d0d566f1815adef9cd',
        'Authorization': 'HUNLIJI 4f41585aa883d6d01adef2abfdfb66fbf9d00a1f:49F14C2D-F0F9-4BB2-BC49-B6159CBDEAA2',
        'appName': 'hljPlus'
    };

    let currentPage = 1;
    const perPage = 20; // 根据你的接口返回设定

    async function fetchVisitors(page = 1) {
        const url = `${apiUrl}?page=${page}&perPage=${perPage}&cardId=124292756`;
        try {
            const res = await fetch(url, { headers });
            const data = await res.json();

            if (data.success) {
                renderTable(data.data.list);
                renderPagination(data.data.totalCount, page);
            } else {
                alert('请求失败: ' + data.status.msg);
            }
        } catch (err) {
            console.error(err);
            alert('请求出错，请检查控制台');
        }
    }

    function renderTable(list) {
        const tbody = document.getElementById('visitorTableBody');
        tbody.innerHTML = '';
        list.forEach(item => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
      <td>${item.id}</td>
      <td><img src="${item.avatar}" alt="头像" width="50"></td>
      <td>${item.nickName}</td>
      <td>${item.cardId}</td>
      <td>${item.viewCount}</td>
      <td>${item.updatedAt}</td>
      <td>${item.ifHidden}</td>
    `;
            tbody.appendChild(tr);
        });
    }

    function renderPagination(totalCount, page) {
        const pageInfo = document.getElementById('pageInfo');
        const totalPages = Math.ceil(totalCount / perPage);
        pageInfo.textContent = `第 ${page} 页 / 共 ${totalPages} 页`;
        document.getElementById('prevBtn').disabled = page <= 1;
        document.getElementById('nextBtn').disabled = page >= totalPages;
    }

    document.getElementById('prevBtn').addEventListener('click', () => {
        if (currentPage > 1) {
            currentPage--;
            fetchVisitors(currentPage);
        }
    });

    document.getElementById('nextBtn').addEventListener('click', () => {
        currentPage++;
        fetchVisitors(currentPage);
    });

    // 页面加载时请求第一页
    fetchVisitors(currentPage);
</script>

</body>
</html>
